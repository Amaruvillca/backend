<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Crear Sucursal</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""/>
  <style>
    :root {
      --primary: #4361ee;
      --primary-light: #4895ef;
      --secondary: #3f37c9;
      --accent: #f72585;
      --success: #4cc9f0;
      --error: #f94144;
      --light: #f8f9fa;
      --light-gray: #e9ecef;
      --dark: #212529;
      --text: #2b2d42;
      --border-radius: 16px;
      --box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
      --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #f0f2f5 0%, #dfe7f1 100%);
      min-height: 100vh;
      padding: 40px 20px;
      color: var(--text);
    }

    .container {
      max-width: 1000px;
      margin: 0 auto;
      background: white;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      overflow: hidden;
      position: relative;
      border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .form-header {
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      color: white;
      padding: 40px 30px;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .form-header::before {
      content: "";
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 70%);
      transform: rotate(30deg);
    }

    .form-header h2 {
      font-weight: 600;
      font-size: 32px;
      margin-bottom: 10px;
      position: relative;
      text-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .form-header i {
      font-size: 60px;
      margin-bottom: 15px;
      color: rgba(255, 255, 255, 0.2);
      position: relative;
    }

    .form-header p {
      font-size: 16px;
      opacity: 0.9;
      position: relative;
    }

    .form-content {
      padding: 50px;
    }

    .form-group {
      margin-bottom: 30px;
      position: relative;
    }

    label {
      display: block;
      margin-bottom: 12px;
      font-weight: 500;
      font-size: 16px;
      color: var(--text);
      position: relative;
      padding-left: 10px;
    }

    label::before {
      content: "";
      position: absolute;
      left: 0;
      top: 8px;
      height: 12px;
      width: 4px;
      background: var(--primary);
      border-radius: 2px;
    }

    input[type="text"],
    input[type="tel"],
    input[type="number"],
    input[type="datetime-local"] {
      width: 100%;
      padding: 16px 22px;
      border: 2px solid var(--light-gray);
      border-radius: var(--border-radius);
      font-size: 16px;
      transition: var(--transition);
      background-color: var(--light);
      color: var(--text);
      font-family: 'Poppins', sans-serif;
    }

    input:focus {
      outline: none;
      border-color: var(--primary-light);
      background-color: white;
      box-shadow: 0 0 0 4px rgba(67, 97, 238, 0.1);
    }

    .image-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 25px;
      margin-bottom: 40px;
    }

    .image-upload-card {
      position: relative;
      height: 180px;
      border: 2px dashed var(--light-gray);
      border-radius: var(--border-radius);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition);
      background-color: var(--light);
      overflow: hidden;
    }

    .image-upload-card:hover {
      border-color: var(--primary);
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    }

    .image-upload-card i {
      font-size: 36px;
      color: var(--primary);
      margin-bottom: 15px;
      transition: var(--transition);
    }

    .image-upload-card:hover i {
      color: var(--accent);
      transform: scale(1.2);
    }

    .image-upload-card span {
      font-size: 15px;
      color: #6c757d;
      text-align: center;
      transition: var(--transition);
    }

    .image-upload-card:hover span {
      color: var(--text);
    }

    .image-upload-card input {
      display: none;
    }

    .image-preview {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: none;
    }

    .remove-image-btn {
      position: absolute;
      top: 12px;
      right: 12px;
      width: 32px;
      height: 32px;
      background: rgba(255, 255, 255, 0.95);
      border: none;
      border-radius: 50%;
      color: var(--error);
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      display: none;
      z-index: 10;
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
      transition: var(--transition);
    }

    .remove-image-btn:hover {
      background: var(--error);
      color: white;
      transform: scale(1.1) rotate(90deg);
    }

    .form-row {
      display: flex;
      gap: 25px;
      margin-bottom: 30px;
    }

    .form-row .form-group {
      flex: 1;
    }

    /* Mapa Leaflet */
    .map-container {
      margin-bottom: 30px;
    }

    #map {
      height: 400px;
      width: 100%;
      border-radius: var(--border-radius);
      border: 2px solid var(--light-gray);
      overflow: hidden;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
    }

    .map-coordinates {
      display: flex;
      gap: 20px;
      margin-top: 15px;
    }

    .map-coordinates .form-group {
      margin-bottom: 0;
      flex: 1;
    }

    .checkbox-container {
      display: flex;
      align-items: center;
      margin: 40px 0;
      position: relative;
      padding-left: 35px;
      cursor: pointer;
    }

    .checkbox-container input {
      position: absolute;
      opacity: 0;
      cursor: pointer;
      height: 0;
      width: 0;
    }

    .checkmark {
      position: absolute;
      top: 0;
      left: 0;
      height: 24px;
      width: 24px;
      background-color: var(--light);
      border: 2px solid var(--light-gray);
      border-radius: 6px;
      transition: var(--transition);
    }

    .checkbox-container:hover .checkmark {
      border-color: var(--primary-light);
    }

    .checkbox-container input:checked ~ .checkmark {
      background-color: var(--primary);
      border-color: var(--primary);
    }

    .checkmark:after {
      content: "";
      position: absolute;
      display: none;
    }

    .checkbox-container input:checked ~ .checkmark:after {
      display: block;
    }

    .checkbox-container .checkmark:after {
      left: 8px;
      top: 4px;
      width: 6px;
      height: 12px;
      border: solid white;
      border-width: 0 2px 2px 0;
      transform: rotate(45deg);
    }

    .checkbox-container label {
      margin-bottom: 0;
      cursor: pointer;
      font-weight: 500;
      color: var(--text);
      padding-left: 0;
    }

    .checkbox-container label::before {
      display: none;
    }

    .submit-btn {
      width: 100%;
      padding: 20px;
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      color: white;
      border: none;
      border-radius: var(--border-radius);
      font-size: 18px;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      margin-top: 20px;
      box-shadow: 0 5px 20px rgba(67, 97, 238, 0.3);
      text-transform: uppercase;
      letter-spacing: 1.2px;
      position: relative;
      overflow: hidden;
    }

    .submit-btn::after {
      content: "";
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(
        to bottom right,
        rgba(255, 255, 255, 0.3) 0%,
        rgba(255, 255, 255, 0) 60%
      );
      transform: translateY(0) rotate(0);
      transition: var(--transition);
    }

    .submit-btn:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(67, 97, 238, 0.4);
    }

    .submit-btn:hover::after {
      transform: translateY(50%) rotate(15deg);
    }

    .submit-btn:active {
      transform: translateY(2px);
    }

    .submit-btn i {
      margin-right: 12px;
      transition: var(--transition);
    }

    .submit-btn:hover i {
      transform: scale(1.1);
    }

    /* Modal */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
      backdrop-filter: blur(5px);
    }

    .modal-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    .modal-content {
      background: white;
      border-radius: var(--border-radius);
      width: 90%;
      max-width: 500px;
      padding: 40px;
      transform: translateY(-50px);
      transition: all 0.3s ease;
      position: relative;
      text-align: center;
      box-shadow: 0 20px 50px rgba(0, 0, 0, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .modal-overlay.active .modal-content {
      transform: translateY(0);
    }

    .modal-close {
      position: absolute;
      top: 20px;
      right: 20px;
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: #6c757d;
      transition: var(--transition);
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
    }

    .modal-close:hover {
      background: var(--light-gray);
      color: var(--error);
      transform: rotate(90deg);
    }

    .modal-icon {
      font-size: 80px;
      margin-bottom: 25px;
      position: relative;
      display: inline-block;
    }

    .modal-icon::after {
      content: "";
      position: absolute;
      top: -10px;
      left: -10px;
      right: -10px;
      bottom: -10px;
      border-radius: 50%;
      z-index: -1;
      opacity: 0.2;
    }

    .modal-icon.success {
      color: var(--success);
    }

    .modal-icon.success::after {
      background: var(--success);
    }

    .modal-icon.error {
      color: var(--error);
    }

    .modal-icon.error::after {
      background: var(--error);
    }

    .modal-title {
      font-size: 28px;
      margin-bottom: 20px;
      font-weight: 600;
      color: var(--text);
    }

    .modal-message {
      margin-bottom: 30px;
      color: #6c757d;
      line-height: 1.6;
      font-size: 16px;
    }

    .modal-btn {
      padding: 14px 30px;
      border: none;
      border-radius: var(--border-radius);
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition);
      font-size: 16px;
      letter-spacing: 0.5px;
      min-width: 150px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

    .modal-btn.success {
      background: linear-gradient(135deg, var(--success) 0%, #38b6db 100%);
      color: white;
    }

    .modal-btn.error {
      background: linear-gradient(135deg, var(--error) 0%, #d62839 100%);
      color: white;
    }

    .modal-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
    }

    @media (max-width: 768px) {
      .form-content {
        padding: 30px;
      }

      .form-header {
        padding: 30px 20px;
      }

      .form-header h2 {
        font-size: 26px;
      }

      .form-row {
        flex-direction: column;
        gap: 0;
      }

      .image-grid {
        grid-template-columns: 1fr;
      }

      .map-coordinates {
        flex-direction: column;
        gap: 15px;
      }

      .submit-btn {
        padding: 16px;
        font-size: 16px;
      }
    }

    @media (max-width: 480px) {
      .form-content {
        padding: 25px 20px;
      }

      .form-header {
        padding: 25px 15px;
      }

      .form-header h2 {
        font-size: 22px;
      }

      .form-header i {
        font-size: 50px;
      }

      input[type="text"],
      input[type="tel"],
      input[type="number"],
      input[type="datetime-local"] {
        padding: 14px 18px;
      }

      .modal-content {
        padding: 30px 20px;
      }

      .modal-title {
        font-size: 24px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="form-header">
      <i class="fas fa-store-alt"></i>
      <h2>Crear Nueva Sucursal</h2>
      <p>Complete el formulario para registrar una nueva sucursal</p>
    </div>
    
    <div class="form-content">
      <form id="sucursal-form" enctype="multipart/form-data">
        <div class="form-group">
          <label for="nombre"><i class="fas fa-signature"></i> Nombre de la Sucursal</label>
          <input type="text" id="nombre" name="nombre" placeholder="Ej: Sucursal Central" required />
        </div>
        
        <div class="form-group">
          <label><i class="fas fa-images"></i> Imágenes de la Sucursal</label>
          <div class="image-grid">
            <div class="image-upload-card" id="upload-card-1">
              <i class="fas fa-camera"></i>
              <span>Imagen Principal</span>
              <input type="file" id="imagen1" name="imagen1" accept="image/*" />
              <img class="image-preview" id="preview-1" />
              <button type="button" class="remove-image-btn">×</button>
            </div>
            <div class="image-upload-card" id="upload-card-2">
              <i class="fas fa-camera"></i>
              <span>Imagen Secundaria</span>
              <input type="file" id="imagen2" name="imagen2" accept="image/*" />
              <img class="image-preview" id="preview-2" />
              <button type="button" class="remove-image-btn">×</button>
            </div>
            <div class="image-upload-card" id="upload-card-3">
              <i class="fas fa-camera"></i>
              <span>Imagen Adicional</span>
              <input type="file" id="imagen3" name="imagen3" accept="image/*" />
              <img class="image-preview" id="preview-3" />
              <button type="button" class="remove-image-btn">×</button>
            </div>
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="telefono"><i class="fas fa-phone"></i> Teléfono</label>
            <input type="tel" id="telefono" name="telefono" placeholder="Ej: 5551234567" />
          </div>
          <div class="form-group">
            <label for="fecha_apertura"><i class="fas fa-calendar-alt"></i> Fecha de Apertura</label>
            <input type="datetime-local" id="fecha_apertura" name="fecha_apertura" />
          </div>
        </div>
        
        <div class="form-group">
          <label for="direccion"><i class="fas fa-map-marker-alt"></i> Dirección</label>
          <input type="text" id="direccion" name="direccion" placeholder="Ej: Av. Principal 123" />
        </div>
        
        <div class="form-group">
          <label for="ciudad"><i class="fas fa-city"></i> Ciudad</label>
          <input type="text" id="ciudad" name="ciudad" placeholder="Ej: Ciudad de México" />
        </div>
        
        <!-- Mapa para seleccionar ubicación -->
        <div class="map-container">
          <label><i class="fas fa-map"></i> Seleccione la ubicación en el mapa</label>
          <div id="map"></div>
          <div class="map-coordinates">
            <div class="form-group">
              <label for="latitud"><i class="fas fa-map-pin"></i> Latitud</label>
              <input type="number" step="any" id="latitud" name="latitud" placeholder="Ej: 19.4326" readonly />
            </div>
            <div class="form-group">
              <label for="longitud"><i class="fas fa-map-pin"></i> Longitud</label>
              <input type="number" step="any" id="longitud" name="longitud" placeholder="Ej: -99.1332" readonly />
            </div>
          </div>
        </div>
        
        <div class="checkbox-container">
          <input type="checkbox" id="estado" name="estado" checked />
          <span class="checkmark"></span>
          <label for="estado">Sucursal activa</label>
        </div>
        
        <button type="submit" class="submit-btn"><i class="fas fa-save"></i> Crear Sucursal</button>
      </form>
    </div>
  </div>
  

  <!-- Modal de éxito/error -->
  <div class="modal-overlay" id="result-modal">
    <div class="modal-content">
      <button class="modal-close" id="modal-close">&times;</button>
      <div class="modal-icon success" id="modal-icon">
        <i class="fas fa-check-circle"></i>
      </div>
      <h3 class="modal-title" id="modal-title">¡Éxito!</h3>
      <p class="modal-message" id="modal-message">La sucursal se ha creado correctamente.</p>
      <button class="modal-btn success" id="modal-btn">Aceptar</button>
    </div>
  </div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script>
    // Inicialización del mapa Leaflet
    let map;
    let marker;
    let defaultLat = -16.5000; // Latitud por defecto (CDMX)
    let defaultLng = -68.1500; // Longitud por defecto (CDMX)
    
    function initMap() {
      // Crear el mapa centrado en la ubicación por defecto
      map = L.map('map').setView([defaultLat, defaultLng], 13);
      
      // Añadir capa de tiles de OpenStreetMap
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
      }).addTo(map);
      
      // Añadir marcador inicial
      marker = L.marker([defaultLat, defaultLng], {
        draggable: true
      }).addTo(map);
      
      // Actualizar campos de coordenadas con la posición inicial
      document.getElementById('latitud').value = defaultLat;
      document.getElementById('longitud').value = defaultLng;
      
      // Evento para cuando se mueve el marcador
      marker.on('dragend', function(e) {
        const position = marker.getLatLng();
        document.getElementById('latitud').value = position.lat.toFixed(6);
        document.getElementById('longitud').value = position.lng.toFixed(6);
      });
      
      // Evento para cuando se hace click en el mapa
      map.on('click', function(e) {
        const { lat, lng } = e.latlng;
        
        // Mover el marcador a la nueva posición
        marker.setLatLng([lat, lng]);
        
        // Actualizar campos de coordenadas
        document.getElementById('latitud').value = lat.toFixed(6);
        document.getElementById('longitud').value = lng.toFixed(6);
      });
      
      // Geocodificación inversa al hacer doble click
      map.on('dblclick', async function(e) {
        const { lat, lng } = e.latlng;
        
        try {
          const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}`);
          const data = await response.json();
          
          if (data.address) {
            // Actualizar campos de dirección y ciudad si existen
            if (data.address.road || data.address.house_number) {
              const direccion = `${data.address.road || ''} ${data.address.house_number || ''}`.trim();
              document.getElementById('direccion').value = direccion;
            }
            
            if (data.address.city || data.address.town || data.address.village) {
              const ciudad = data.address.city || data.address.town || data.address.village;
              document.getElementById('ciudad').value = ciudad;
            }
          }
        } catch (error) {
          console.error('Error en geocodificación inversa:', error);
        }
      });
    }
    
    // Inicializar el mapa cuando el DOM esté cargado
    document.addEventListener('DOMContentLoaded', initMap);

    // Manejo de vistas previas de imágenes
    document.querySelectorAll('.image-upload-card').forEach((card, index) => {
      const input = card.querySelector('input');
      const preview = card.querySelector('.image-preview');
      const removeBtn = card.querySelector('.remove-image-btn');
      const cardId = index + 1;
      
      // Click en el área de upload
      card.addEventListener('click', (e) => {
        if (e.target !== removeBtn) {
          input.click();
        }
      });
      
      // Cambio en el input de archivo
      input.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = (event) => {
            preview.src = event.target.result;
            preview.style.display = 'block';
            card.querySelector('i').style.display = 'none';
            card.querySelector('span').style.display = 'none';
            removeBtn.style.display = 'block';
          };
          reader.readAsDataURL(file);
        }
      });
      
      // Botón para eliminar imagen
      removeBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        input.value = '';
        preview.src = '';
        preview.style.display = 'none';
        card.querySelector('i').style.display = 'block';
        card.querySelector('span').style.display = 'block';
        removeBtn.style.display = 'none';
      });
    });

    // Modal
    const modal = document.getElementById('result-modal');
    const modalClose = document.getElementById('modal-close');
    const modalBtn = document.getElementById('modal-btn');
    
    modalClose.addEventListener('click', () => {
      modal.classList.remove('active');
    });
    
    modalBtn.addEventListener('click', () => {
      modal.classList.remove('active');
    });

    // Envío del formulario con SweetAlert2
    document.getElementById("sucursal-form").addEventListener("submit", async function (e) {
      e.preventDefault();
      const form = e.target;

      // Validar que al menos una imagen se haya subido
      if (!form.imagen1.files[0] && !form.imagen2.files[0] && !form.imagen3.files[0]) {
        Swal.fire({
          title: 'Imágenes requeridas',
          text: 'Por favor suba al menos una imagen de la sucursal',
          icon: 'warning',
          confirmButtonColor: '#4361ee'
        });
        return;
      }

      // Mostrar loader
      Swal.fire({
        title: 'Procesando...',
        html: 'Estamos creando la sucursal',
        allowOutsideClick: false,
        didOpen: () => {
          Swal.showLoading();
        },
        background: 'linear-gradient(135deg, #4361ee 0%, #3f37c9 100%)',
        color: 'white',
        backdrop: `
          rgba(67, 97, 238, 0.4)
          url("/images/nyan-cat.gif")
          left top
          no-repeat
        `
      });

      // Preparamos los datos en un objeto
      const datosJson = {
        nombre: form.nombre.value,
        telefono: form.telefono.value ? parseInt(form.telefono.value) : null,
        fecha_apertura: form.fecha_apertura.value || null,
        direccion: form.direccion.value || null,
        ciudad: form.ciudad.value || null,
        latitud: parseFloat(form.latitud.value),
        longitud: parseFloat(form.longitud.value),
        estado: form.estado.checked
      };

      const formData = new FormData();
      formData.append("datos", JSON.stringify(datosJson));

      if (form.imagen1.files[0]) formData.append("imagen1", form.imagen1.files[0]);
      if (form.imagen2.files[0]) formData.append("imagen2", form.imagen2.files[0]);
      if (form.imagen3.files[0]) formData.append("imagen3", form.imagen3.files[0]);

      try {
        const response = await fetch("http://localhost:8000/sucursales/", {
          method: "POST",
          body: formData
        });

        const result = await response.json();
        
        Swal.close();

        if (response.ok) {
          // Mostrar SweetAlert2 de éxito
          Swal.fire({
            title: '¡Éxito!',
            text: `${result.mensaje} (ID: ${result.id_sucursal})`,
            icon: 'success',
            confirmButtonText: 'Aceptar',
            confirmButtonColor: '#4361ee',
            background: 'white',
            backdrop: `
              rgba(67, 97, 238, 0.4)
              url("/images/confetti.gif")
              center top
              no-repeat
            `,
            customClass: {
              title: 'text-primary',
              confirmButton: 'shadow-primary'
            }
          }).then(() => {
            // Resetear formulario
            form.reset();
            // Limpiar vistas previas
            document.querySelectorAll('.image-preview').forEach(preview => {
              preview.style.display = 'none';
              preview.src = '';
            });
            document.querySelectorAll('.image-upload-card i').forEach(icon => {
              icon.style.display = 'block';
            });
            document.querySelectorAll('.image-upload-card span').forEach(span => {
              span.style.display = 'block';
            });
            document.querySelectorAll('.remove-image-btn').forEach(btn => {
              btn.style.display = 'none';
            });
            // Restablecer marcador a posición inicial
            marker.setLatLng([defaultLat, defaultLng]);
            map.setView([defaultLat, defaultLng], 13);
            document.getElementById('latitud').value = defaultLat;
            document.getElementById('longitud').value = defaultLng;
          });
        } else {
          // Mostrar SweetAlert2 de error
          Swal.fire({
            title: 'Error',
            text: result.detail || "No se pudo crear la sucursal",
            icon: 'error',
            confirmButtonText: 'Entendido',
            confirmButtonColor: '#f94144',
            background: 'white',
            backdrop: `
              rgba(249, 65, 68, 0.4)
            `,
            customClass: {
              title: 'text-error',
              confirmButton: 'shadow-error'
            }
          });
        }
      } catch (error) {
        Swal.close();
        Swal.fire({
          title: 'Error de red',
          text: error.message,
          icon: 'error',
          confirmButtonText: 'Entendido',
          confirmButtonColor: '#f94144',
          background: 'white'
        });
      }
    });
  </script>
</body>
</html>